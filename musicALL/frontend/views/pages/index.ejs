<div class="container-fluid">
    <div class="row mt-3">
        <!-- Seções de categorias -->
        <div class="col-md-3">
            <h5 class="font-weight-bold">Category</h5>
            <form id="filter-form">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="category" value="Instrumentos" id="cat1">
                    <label class="form-check-label" for="cat1">Instrumentos Musicais</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="category" value="Guitarra" id="cat2">
                    <label class="form-check-label" for="cat2">Guitarra</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="category" value="Bateria" id="cat3">
                    <label class="form-check-label" for="cat3">Bateria</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="category" value="Piano" id="cat4">
                    <label class="form-check-label" for="cat4">Piano</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="category" value="Saxofone" id="cat5">
                    <label class="form-check-label" for="cat5">Saxofone</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="category" value="Microfone" id="cat6">
                    <label class="form-check-label" for="cat6">Microfone</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="category" value="Acessório" id="cat7">
                    <label class="form-check-label" for="cat7">Acessório</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="category" value="Percussão" id="cat8">
                    <label class="form-check-label" for="cat8">Percussão</label>
                </div>
              
                <h5 class="font-weight-bold">Price Range</h5>
            
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="price" value="All Prices" id="price1" checked>
                    <label class="form-check-label" for="price1">All Prices</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="price" value="Under 200" id="price2">
                    <label class="form-check-label" for="price2">Under R$200,00</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="price" value="200 to 500" id="price3">
                    <label class="form-check-label" for="price3">R$200,00 to R$500,00</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="price" value="500 to 1000" id="price4">
                    <label class="form-check-label" for="price4">R$500,00 to R$1000,00</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="price" value="1000 to 5000" id="price5">
                    <label class="form-check-label" for="price5">R$1000,00 to R$5000,00</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="price" value="Over 5000" id="price6">
                    <label class="form-check-label" for="price6">Over R$5000,00</label>
                </div>
                
        
                <h5 class="font-weight-bold">Popular Brands</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="Yamaha" id="brand1">
                            <label class="form-check-label" for="brand1">Yamaha</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="Fender" id="brand2">
                            <label class="form-check-label" for="brand2">Fender</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="Gibson" id="brand3">
                            <label class="form-check-label" for="brand3">Gibson</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="Korg" id="brand4">
                            <label class="form-check-label" for="brand4">Korg</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="Roland" id="brand5">
                            <label class="form-check-label" for="brand5">Roland</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="Ibanez" id="brand6">
                            <label class="form-check-label" for="brand6">Ibanez</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="Marshall" id="brand7">
                            <label class="form-check-label" for="brand7">Marshall</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="Peavey" id="brand8">
                            <label class="form-check-label" for="brand8">Peavey</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="Line 6" id="brand9">
                            <label class="form-check-label" for="brand9">Line 6</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="Orange" id="brand10">
                            <label class="form-check-label" for="brand10">Orange</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="BOSS" id="brand11">
                            <label class="form-check-label" for="brand11">BOSS</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="Squier" id="brand12">
                            <label class="form-check-label" for="brand12">Squier</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="Takamine" id="brand13">
                            <label class="form-check-label" for="brand13">Takamine</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="brand" value="Epiphone" id="brand14">
                            <label class="form-check-label" for="brand14">Epiphone</label>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary mt-3">Apply Filters</button>
            </form>

            <h5 class="category-title">Popular Tags</h5>
            <div class="filter-buttons">
                <button class="filter-btn" data-filter="instrumentos">Instrumentos Musicais</button>
                <button class="filter-btn" data-filter="guitarra">Guitarra</button>
                <button class="filter-btn" data-filter="bateria">Bateria</button>
                <button class="filter-btn" data-filter="piano">Piano & Teclado</button>
                <button class="filter-btn" data-filter="saxofone">Saxofone</button>
            </div>
        </div>

        <!-- produtss -->
        <div class="col-md-9">      
           <div id="products-list">
                <div class="row justify-content-start">
                    <!-- produtos renderizados dinamicamente -->
                </div>
            </div>

            <!-- Paginação -->
            <nav aria-label="Product Pagination">
                <ul class="pagination justify-content-center">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1">‹</a>
                    </li>
                    <% for (let i = 1; i <= 2; i++) { %>
                        <li class="page-item <%= i === 1 ? 'active' : '' %>">
                            <a class="page-link" href="#"><%= i < 10 ? '0' + i : i %></a>
                        </li>
                    <% } %>
                    <li class="page-item">
                        <a class="page-link" href="#">›</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<script>
    // carrega todos os produtos e exibe inicialmente
    let allProducts = <%- JSON.stringify(products) %>;
    const Url = '<%= serverUrl %>';
   

    // renderiza
    function renderProducts(products) {
        
        const productsList = document.querySelector('#products-list .row'); 
        productsList.innerHTML = ''; // Limpar a lista

        if (products.length > 0) {
            products.slice(0, 6).forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.classList.add('col-md-4', 'product-col');
                productDiv.innerHTML = `
                    <a href="/product/${product.id}" class="product-card">
                        <img src="${Url+product.images[0]}" class="img-fluid" alt="${product.name}">
                        <p class="product-title">${product.name}</p>
                        <p class="product-text"><strong>Seller: ${product.sellerName}<strong></p>
                        <p class="product-price">R$ ${product.price.toFixed(2).replace('.', ',')}</p>
                    </a>
                `;
                productsList.appendChild(productDiv);
                console.log(product.images[0]);
            });
        } else {
            productsList.innerHTML = '<p>No products available.</p>';
        }
    }

    // renderiza todos os produtos inicialmente
    renderProducts(allProducts);

    // filtro frontend
    document.getElementById('filter-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Impede o envio padrão

        const formData = new FormData(this);
        const selectedCategories = formData.getAll('category');
        const selectedPrice = formData.get('price');
        const selectedBrands = formData.getAll('brand');

        let filteredProducts = allProducts;

        // filtro categorias
        if (selectedCategories.length > 0) {
            filteredProducts = filteredProducts.filter(product =>
                selectedCategories.some(cat => product.categories.includes(cat))
            );
        }

        // filtro preço
        if (selectedPrice && selectedPrice !== 'All Prices') {
            filteredProducts = filteredProducts.filter(product => {
                if (selectedPrice === 'Under 200') return product.price < 200;
                if (selectedPrice === '200 to 500') return product.price >= 200 && product.price <= 500;
                if (selectedPrice === '500 to 1000') return product.price >= 500 && product.price <= 1000;
                if (selectedPrice === '1000 to 5000') return product.price >= 1000 && product.price <= 5000;
                if (selectedPrice === 'Over 5000') return product.price > 5000;
            });
        }

        
        if (selectedBrands.length > 0) {
            filteredProducts = filteredProducts.filter(product =>
                selectedBrands.includes(product.brand)
            );
        }

        // renderiza os produtos filtrados
        renderProducts(filteredProducts);
    });
</script>
