<div class="container">

    <!-- Bloco settings -->
    <div class="card mb-4">
        <div class="card-header">
            ACCOUNT SETTINGS
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-2 text-center">
                    <img src="assets/profile_pic.png" alt="Profile Picture" class="rounded-circle">
                </div>
                <!-- Coluna esquerda -->
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="displayName">Name</label>
                        <input type="text" class="form-control" id="displayName">
                    </div>
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" class="form-control" id="fullName">
                    </div>
                    <div class="form-group">
                        <label for="secondaryEmail">Secondary Email</label>
                        <input type="text" class="form-control" id="secondaryEmail">
                    </div>
                    <div class="form-group">
                        <label for="countryRegion">Country/Region</label>
                        <input type="text" class="form-control" id="countryRegion">
                    </div>
                    <button type="button" class="btn save-account-btn">SAVE CHANGES</button>
                </div>
                <!-- Coluna direita -->
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" class="form-control" id="username">
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" class="form-control" id="email">
                    </div>
                    <div class="form-group">
                        <label for="phoneNumber">Phone Number</label>
                        <input type="text" class="form-control" id="phoneNumber">
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="states">State</label>
                            <input type="text" class="form-control" id="states">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="zipCode">Zip Code</label>
                            <input type="text" class="form-control" id="zipCode">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
     <div class="row">

        <!-- Bloco endereço de entrega -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    SHIPPING ADDRESS
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="shippingFirstName">First Name</label>
                            <input type="text" class="form-control" id="shippingFirstName">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="shippingLastName">Last Name</label>
                            <input type="text" class="form-control" id="shippingLastName">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="shippingCompanyName">Company Name (Optional)</label>
                        <input type="text" class="form-control" id="shippingCompanyName">
                    </div>
                    <div class="form-group">
                        <label for="shippingAddress">Address</label>
                        <input type="text" class="form-control" id="shippingAddress">
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="shippingCountry">Country</label>
                            <input type="text" class="form-control" id="shippingCountry">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="shippingRegion">State</label>
                            <input type="text" class="form-control" id="shippingRegion">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="shippingCity">City</label>
                            <input type="text" class="form-control" id="shippingCity">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="shippingZipCode">Zip Code</label>
                            <input type="text" class="form-control" id="shippingZipCode">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="shippingEmail">Email</label>
                        <input type="email" class="form-control" id="shippingEmail">
                    </div>
                    <div class="form-group">
                        <label for="shippingPhoneNumber">Phone Number</label>
                        <input type="text" class="form-control" id="shippingPhoneNumber">
                    </div>
                    <button type="button" class="btn save-shipping-btn">SAVE CHANGES</button>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    CHANGE PASSWORD
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <input type="password" class="form-control" id="currentPassword">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" class="form-control" id="newPassword">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <input type="password" class="form-control" id="confirmPassword">
                    </div>
                    <button type="button" class="btn save-password-btn">CHANGE PASSWORD</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Preencher campos ao iniciar a página
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/profile/info')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('displayName').value = data.user.name || '';
                    document.getElementById('fullName').value = data.user.fullName || '';
                    document.getElementById('secondaryEmail').value = data.user.securityEmail || '';
                    document.getElementById('countryRegion').value = data.user.country || '';
                    document.getElementById('username').value = data.user.username || '';
                    document.getElementById('email').value = data.user.email || '';
                    document.getElementById('phoneNumber').value = data.user.phone || '';
                    document.getElementById('states').value = data.user.state || '';
                    document.getElementById('zipCode').value = data.user.zip || '';

                    document.getElementById('shippingFirstName').value = data.user.shippingAddress.firstName || '';
                    document.getElementById('shippingLastName').value = data.user.shippingAddress.lastName || '';
                    document.getElementById('shippingCompanyName').value = data.user.shippingAddress.companyName || '';
                    document.getElementById('shippingAddress').value = data.user.shippingAddress.address || '';
                    document.getElementById('shippingCountry').value = data.user.shippingAddress.country || '';
                    document.getElementById('shippingRegion').value = data.user.shippingAddress.state || '';
                    document.getElementById('shippingCity').value = data.user.shippingAddress.city || '';
                    document.getElementById('shippingZipCode').value = data.user.shippingAddress.zip || '';
                    document.getElementById('shippingEmail').value = data.user.shippingAddress.email || '';
                    document.getElementById('shippingPhoneNumber').value = data.user.shippingAddress.phone || '';
                } else {
                    alert('Failed to load profile information');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to load profile information');
            });
    });

    // Salvar detalhes da conta
    document.querySelector('.save-account-btn').addEventListener('click', () => {
        const accountData = {
            displayName: document.getElementById('displayName').value,
            fullName: document.getElementById('fullName').value,
            secondaryEmail: document.getElementById('secondaryEmail').value,
            countryRegion: document.getElementById('countryRegion').value,
            username: document.getElementById('username').value,
            email: document.getElementById('email').value,
            phoneNumber: document.getElementById('phoneNumber').value,
            state: document.getElementById('states').value,
            zip: document.getElementById('zipCode').value
        };

        fetch('/profile/update/account', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(accountData),
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Account updated successfully!');
            } else {
                alert('Error updating account');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to update account');
        });
    });

    // Salvar endereço de entrega
    document.querySelector('.save-shipping-btn').addEventListener('click', () => {
        const shippingData = {
            firstName: document.getElementById('shippingFirstName').value,
            lastName: document.getElementById('shippingLastName').value,
            companyName: document.getElementById('shippingCompanyName').value,
            address: document.getElementById('shippingAddress').value,
            country: document.getElementById('shippingCountry').value,
            region: document.getElementById('shippingRegion').value,
            city: document.getElementById('shippingCity').value,
            zip: document.getElementById('shippingZipCode').value,
            email: document.getElementById('shippingEmail').value,
            phone: document.getElementById('shippingPhoneNumber').value,
        };

        fetch('/profile/update/shipping', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(shippingData),
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Shipping address updated successfully!');
            } else {
                alert('Error updating shipping address');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to update shipping address');
        });
    });

    // Mudar senha
    document.querySelector('.save-password-btn').addEventListener('click', () => {
        const passwordData = {
            currentPassword: document.getElementById('currentPassword').value,
            newPassword: document.getElementById('newPassword').value,
            confirmPassword: document.getElementById('confirmPassword').value
        };

        fetch('/profile/update/password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(passwordData),
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Password updated successfully!');
            } else {
                alert('Error updating password');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to update password');
        });
    });
</script>
