<body>
    <div class="container mt-5">
        <div class="row">
            <!-- Imagens do Produto -->
            <div class="col-lg-6">
                <div class="product-images">
                    <div id="mainImageContainer">
                        <img id="mainImage" class="d-block w-100 main-image" src="<%= product.images[0] %>" alt="Main Image">
                    </div>
                    <div class="d-flex mt-3 thumbnail-images">
                        <% product.images.forEach((img, index) => { %>
                            <img src="<%= img %>" alt="Thumb" class="img-thumbnail" onclick="changeMainImage('<%= img %>')">
                        <% }); %>
                    </div>
                </div>
            </div>
    
            <!-- Detalhes do Produto -->
            <div class="col-md-6">
                <h1 class="display-6"><%= product.name %></h1>
                <p class="text-muted">
                    <br>Seller: <strong><%= product.seller %></strong>
                    <br>Rating: <%= product.rating %>/5
                    <br>Brand: <%= product.brand %>
                    <br>Availability: <span class="text-success"><%= product.availability %></span>
                    <br>Categories: <%= product.categories.join(', ') %>
                </p>
                <h2 class="text-primary">R$ <%= parseFloat(product.price).toFixed(2).replace('.', ',') %></h2>
    
                <div class="mt-4">
                    <h5>Video demonstration</h5>
                    <video class="Image-fluid" id="meuVideo" controls>
                        <source src="<%= product.video %>" type="video/mp4">
                        Seu navegador não suporta a tag de vídeo.
                    </video>
                </div>
    
                <div class="mt-3">
                    <button class="chat-btn w-100 mb-3" id="chat-button">CHAT WITH THE SELLER</button>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="input-group quantity-input w-50">
                            <button class="btn btn-outline-secondary" type="button" id="button-minus">−</button>
                            <input type="text" class="form-control text-center" value="01" aria-label="Quantity" aria-describedby="button-minus">
                            <button class="btn btn-outline-secondary" type="button" id="button-plus">+</button>
                        </div>
                        <button class="btn btn-lg flex-grow-1 ms-3" id="add-to-cart" onclick="addToCart()">ADD TO CART</button>
                        <form action="http://localhost:8091/api/cart/buy-now" method="POST">
                            <input type="hidden" name="id" value="<%= product.id %>">
                            <input type="hidden" name="quantity" id="buy-now-quantity" value="1">
                            <button type="submit" class="btn btn-lg w-100" id="buy-now">BUY NOW</button>
                        </form>
                        
                        
                    </div>
                </div>
    
                <div class="mt-4">
                    <h6 class="text-muted">100% Guarantee Safe Checkout</h6>
                </div>
            </div>
        </div>
    
        <div class="row mt-5">
            <!-- Descrição do Produto -->
            <div class="col-lg-8">
                <div class="product-description">
                    <input type="checkbox" id="tab-checkbox">
                    <label for="tab-checkbox" id="tab-label">Descrição</label>
                    <div class="tab-content">
                        <% product.description.forEach(desc => { %>
                            <p><%= desc %></p>
                        <% }); %>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    
        // Função para adicionar o produto ao carrinho
        function addToCart() {
        const productId = "<%= product.id %>"; // O ID do produto carregado dinamicamente
        const quantity = document.querySelector('.quantity-input input').value; // Quantidade selecionada

        // Montar os dados do produto (apenas o ID e a quantidade)
        const productData = {
            id: productId,
            quantity: quantity
        };

    // Enviar os dados para o Servidor B (API)
        fetch('http://localhost:8091/api/cart', { // Altere para a rota do Servidor B
            method: 'PUT', // Usando PUT para adicionar/atualizar itens no carrinho
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(productData)
        })
        .then(response => response.json())
        .then(data => {
            console.log('Resposta da API:', data); // Exibir a resposta completa no console
            if (data.success) {
                alert('Produto adicionado ao carrinho!');
            } else {
                alert('Erro ao adicionar ao carrinho.');
            }
        })
        .catch(error => {
            console.error('Erro:', error);
            alert('Houve um erro ao tentar adicionar o produto ao carrinho. Tente novamente.');
        });
}

    
        // para atualizar o input da quantidade
        document.querySelector('#button-plus').addEventListener('click', function() {
            const quantityInput = document.querySelector('.quantity-input input');
            quantityInput.value = parseInt(quantityInput.value) + 1;
            document.querySelector('#buy-now-quantity').value = quantityInput.value; // Atualiza a quantidade do botão "BUY NOW"
        });
    
        document.querySelector('#button-minus').addEventListener('click', function() {
            const quantityInput = document.querySelector('.quantity-input input');
            if (parseInt(quantityInput.value) > 1) {
                quantityInput.value = parseInt(quantityInput.value) - 1;
                document.querySelector('#buy-now-quantity').value = quantityInput.value; // Atualiza a quantidade do botão "BUY NOW"
            }
        });
    
        // Função para alterar a imagem principal ao clicar nas miniaturas
        function changeMainImage(imageUrl) {
            // Atualizar a imagem principal
            document.getElementById('mainImage').src = imageUrl;
    
            // Remover a classe 'active' de todas as miniaturas
            document.querySelectorAll('.thumbnail-images img').forEach(img => {
                img.classList.remove('active');
            });
    
            // Adicionar a classe 'active' à miniatura clicada
            document.querySelector(`.thumbnail-images img[src='${imageUrl}']`).classList.add('active');
        }
    </script>
    
    </body>
    